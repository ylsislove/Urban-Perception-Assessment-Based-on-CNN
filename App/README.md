# TraceVideo
## 安装
下载 `app-release.apk` 文件至手机，安装即可。该 App 只在本人 OPPO 手机上进行过测试，未在其他手机上测试过，所以可能会有未知的 Bug。源码已放出，有能力的小伙伴可以根据需求自行开发。

## 数据采集
通过Android手机自带的位置传感器和GPS，获取到当前位置的经度、纬度、高度、速度、方向、测量精度等信息。同时在数据记录方面做了小小的优化，只有当间隔时间1s同时距离超过4米的时候才会进行记录。这样做的目的是为了防止在红绿灯或堵车等情况下同一个地点记录了过多数据的问题。需要注意的是，通过手机自带的GPS传感器记录下的经纬度是WGS84坐标系下的，后面进行可视化的时候需要根据底图进行坐标转换。

![App界面展示](https://cdn.jsdelivr.net/gh/ylsislove/Urban-Perception-Assessment-Based-on-CNN/App%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA.jpg)

在需要采集的地点，只需要点击左上角的Capture按钮，就会开始录制视频，同时将位置信息记录到csv文件中，将视频的开始时间和结束时间记录到txt文件中。数据保存在存储目录下的 `MyCameraApp` 文件夹下。

在AntV进行可视化时使用的是高德的底图，所以这里需要将采集到的WGS84坐标系下经纬度数据转为火星坐标系下的经纬度数据。

## 数据处理
1. 根据csv文件中每一条记录所对应的时间，计算出与该时间对应的图像在视频流中的帧数。
2. 通过OpenCV对相应帧数的图像，进行图像增强，旋转和必要的裁剪，并保存。
3. 通过Python将csv文件转换为AntV可视化所需的json，csv或GeoJson格式。

## 可能遇到的问题
1. 打开 App 后提示 `摄像头正在使用`
答：这是由于没有在设置中放开 `摄像头` 权限引起的，可以在手机设置中为应用放开相关权限。

2. `GPS` 无信号
答：请走至空旷处，多等待几分钟查看 GPS 是否有信号。该 App 只在本人 OPPO 手机上进行过测试，未在其他手机上测试过，所以可能会有未知的 Bug。源码已放出，有能力的小伙伴可以根据需求自行开发。